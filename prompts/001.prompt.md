---
chatSessionId: cfef11f5-b8c7-430f-900a-d1aa0ff7d14b
---

我想要做一個 chrome extension
目的是要當一個 bridge ，連接local app (desktop app) 與瀏網頁的 ai assistant

例如：
使用者用 local app 對 ChatGPT 送出 prompt -> bridge extension 接收到，在瀏覽器上打開 ChatGPT 網頁，將使用者的 prompt 填入 input box，然後自動點擊送出 -> extension 等待 ChatGPT model 產出結果後，抓取結果並回傳給 local app

請分析
- 有哪些技術挑戰？
- local app 要如何與 extension 溝通？


---

Task: Build a extension that acts as a **bridge between a local desktop app and an AI assistant web page (e.g., ChatGPT)**.

The goal is:
* The **local app sends a initial or continuous prompt** to the extension.
* The extension **opens the ChatGPT webpage**, **open the specified chat (if given) or a new chat page**,  **fills the prompt into the input box**, **submits it**, then **waits for the model's response**.
* Once the result is ready, the extension **extracts the answer text and returns it back** to the local app.

Architecture:
* The extension acts as a **WebSocket client**, connecting to a **WebSocket server running locally** (`ws://127.0.0.1:<port>`), which is started by the desktop app.
* All message passing between local app ↔ extension ↔ web page must use structured JSON.

* The content script should:
1. Wait for the page to fully load and confirm login status.
2. Locate the input textbox reliably (avoid fragile selectors).
3. Simulate real user input events (e.g., `focus`, `input`, `keydown(Enter)`).
4. Submit the prompt and detect when the model starts responding.
5. Use `MutationObserver` to stream partial outputs and detect when the final answer is complete.
6. Extract the final response as Markdown and HTML and send it back.

Attention:
* Avoid over engineering
* Simple, clear design

Step:
Design the architecture, include api, interface, etc. do not edit yet.
